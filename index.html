<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">

  <title>Ù…Ø§Ø´ÛŒÙ†â€ŒØ­Ø³Ø§Ø¨ Ø³ÙØ§Ø±Ø´Ø§Øª Ø¨ÙÙ„ÙˆÛŒÙ€Ù€Ø§</title>

  <!-- PWA Requirements -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#a68b78">

  <!-- iOS PWA -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Belvia Calc">
  <link rel="apple-touch-icon" href="Brown.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="Brown.png">

  <!-- Persian Font -->
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    :root {
      --accent: #a68b78;
      --accent-dark: #8c6f5b;
      --bg-color: #faf7f3;
      --card-bg: #ffffff;
      --text-main: #2a2a2a;
      --border: #e3ddd8;
      --muted: #7a736d;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 25px;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      background: radial-gradient(circle at top, #ffffff 0%, #f2ede9 60%, #e7e1db 100%);
      font-family: "Vazirmatn", sans-serif;
      color: var(--text-main);
    }

    .container {
      width: 100%;
      max-width: 960px;
      background: var(--card-bg);
      border-radius: 22px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.10);
      padding: 24px 28px 30px;
    }

    .header-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 10px;
    }

    .logo-box {
      text-align: center;
      margin-bottom: 10px;
    }

    .logo-box img {
      height: 150px;
      filter: drop-shadow(0 4px 10px rgba(0,0,0,0.18));
      background: #ffffff;
      border-radius: 50%;
      padding: 8px;
    }

    .title-box {
      flex: 1;
      text-align: center;
    }

    h1 {
      margin: 0 0 8px;
      font-size: 1.4rem;
      font-weight: 600;
      color: var(--accent-dark);
    }

    .desc {
      color: var(--muted);
      margin-bottom: 8px;
      font-size: 0.85rem;
    }

    .lang-box {
      text-align: left;
    }

    #langToggle {
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #f5eee7;
      font-size: 0.8rem;
      cursor: pointer;
      font-weight: 500;
      color: #6c5e53;
    }

    .top-row {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    input[type="number"], input[type="text"] {
      padding: 7px 9px;
      border-radius: 10px;
      border: 1px solid var(--border);
      font-size: 0.85rem;
    }

    #customerName {
      width: 220px;
      direction: rtl;
      text-align: right;
    }

    input[type="number"] {
      width: 110px;
      text-align: left;
      direction: ltr;
    }

    #eurRateInput {
      width: 130px;
      text-align: left;
      direction: ltr;
    }

    .product-name-input {
      width: 140px;
      direction: rtl;
      text-align: right;
    }

    button {
      padding: 8px 18px;
      border-radius: 999px;
      border: none;
      font-size: 0.85rem;
      cursor: pointer;
      font-weight: 500;
    }

    .btn-main {
      background: linear-gradient(135deg, var(--accent), var(--accent-dark));
      color: white;
      box-shadow: 0 10px 18px rgba(166,139,120,0.35);
    }

    .btn-ghost {
      background: #f5eee7;
      color: #6c5e53;
      border-radius: 999px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      font-size: 0.85rem;
      border-radius: 14px;
      overflow: hidden;
    }

    table th, table td {
      border: 1px solid var(--border);
      padding: 8px;
      text-align: center;
    }

    table th {
      background: #f7f2ee;
      color: #6c5e53;
      font-weight: 600;
    }

    .section-title {
      margin-top: 24px;
      margin-bottom: 8px;
      font-size: 1rem;
      font-weight: 600;
      color: var(--accent-dark);
    }

    .result-block {
      margin-top: 10px;
      padding: 12px 14px;
      border-radius: 14px;
      background: #f9f6f2;
      border: 1px solid #e8e2dc;
      font-size: 0.9rem;
    }

    .result-line {
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
    }

    .highlight {
      font-weight: 600;
      color: var(--accent-dark);
    }

    .footer {
      margin-top: 20px;
      text-align: center;
      font-size: 0.75rem;
      color: var(--muted);
    }
  </style>
</head>

<body>

<div class="container">
  <div class="header-row">
    <div class="logo-box">
      <img src="Brown.png" alt="Belvia Logo">
    </div>
    <div class="title-box">
      <h1 id="appTitle">Ù…Ø§Ø´ÛŒÙ†â€ŒØ­Ø³Ø§Ø¨ Ø³ÙØ§Ø±Ø´Ø§Øª Ø¨ÙÙ„ÙˆÛŒÙ€Ù€Ø§</h1>
      <p class="desc" id="appDesc">Ù…Ø­Ø§Ø³Ø¨Ù‡â€ŒÛŒ Ù‚ÛŒÙ…ØªØŒ Ø¨Ø§Ø±Ø¨Ø±ÛŒØŒ Ø³ÙˆØ¯ Ùˆ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÛŒ Ù†Ù‡Ø§ÛŒÛŒ (Ø¯Ø§Ø®Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Belvia)</p>
    </div>
    <div class="lang-box">
      <button id="langToggle" type="button" onclick="toggleLanguage()">English ğŸ‡¬ğŸ‡§</button>
    </div>
  </div>

  <div class="top-row">
    <label id="labelCustomer">Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ:</label>
    <input id="customerName" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹ Ø®Ø§Ù†Ù… Ø±Ø¶Ø§ÛŒÛŒ">
  </div>

  <!-- Ù†Ø±Ø® ÛŒÙˆØ±Ùˆ Ø¨Ù‡ Ø±ÛŒØ§Ù„ Ø¨Ø± Ø§Ø³Ø§Ø³ Bonbast (ÙˆØ±ÙˆØ¯ Ø¯Ø³ØªÛŒ) -->
  <div class="top-row">
    <span id="labelEurRate" style="font-size:0.85rem;">Ù†Ø±Ø® ÛŒÙˆØ±Ùˆ Ø¨Ù‡ Ø±ÛŒØ§Ù„ (Bonbast):</span>
    <input id="eurRateInput" type="number" placeholder="Ù…Ø«Ù„Ø§Ù‹ 620000">
    <button id="btnSetRate" class="btn-main" type="button" onclick="setEurRateFromInput()">Ø«Ø¨Øª Ù†Ø±Ø®</button>
    <button id="btnOpenBonbast" class="btn-ghost" type="button" onclick="openBonbast()">Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Bonbast</button>
    <span id="eurRateLabel" style="font-size:0.8rem;color:#7a736d;">(Ù‡Ù†ÙˆØ² ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡)</span>
  </div>

  <div class="top-row">
    <label id="labelNumProducts">ØªØ¹Ø¯Ø§Ø¯ Ù…Ø­ØµÙˆÙ„Ø§Øª:</label>
    <input id="numProducts" type="number" min="1" value="1">
    <button id="btnGenerate" class="btn-main" onclick="generateRows()">Ø«Ø¨Øª Ù…Ø­ØµÙˆÙ„Ø§Øª</button>
  </div>

  <table id="productsTable" style="display:none;">
    <thead>
      <tr>
        <th id="thIndex">Ø±Ø¯ÛŒÙ</th>
        <th id="thName">Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„</th>
        <th id="thPrice">Ù‚ÛŒÙ…Øª (â‚¬)</th>
        <th id="thWeight">ÙˆØ²Ù† (kg)</th>
        <th id="thDiscount">ØªØ®ÙÛŒÙ (%)</th>
      </tr>
    </thead>
    <tbody id="productsTbody"></tbody>
  </table>

  <button id="calcBtn" class="btn-main" style="display:none;margin-top:12px;" onclick="calculate()">Ù…Ø­Ø§Ø³Ø¨Ù‡</button>
  <button id="invoiceBtn" class="btn-main" style="display:none;margin-top:12px;" onclick="openInvoiceWindow()">ÙØ§Ú©ØªÙˆØ± PDF Ø¨Ø±Ø§ÛŒ Ù…Ø´ØªØ±ÛŒ</button>

  <div id="resultsSection" style="display:none;">

    <h2 class="section-title" id="sectionCustomerTitle">Ù†ØªØ§ÛŒØ¬ Ø¨Ø±Ø§ÛŒ Ù…Ø´ØªØ±ÛŒ</h2>
    <div class="result-block">
      <div class="result-line">
        <span id="lblTotalBase">Ø¬Ù…Ø¹ Ù‚ÛŒÙ…Øª Ú©Ø§Ù„Ø§ (Ø¨Ø¹Ø¯ Ø§Ø² ØªØ®ÙÛŒÙ):</span><span id="r_totalBase"></span>
      </div>
      <div class="result-line">
        <span id="lblTotalWeight">ÙˆØ²Ù† Ú©Ù„ Ø³ÙØ§Ø±Ø´:</span><span id="r_totalWeight"></span>
      </div>
      <div class="result-line">
        <span id="lblShipRate">Ù†Ø±Ø® Ø¨Ø§Ø±Ø¨Ø±ÛŒ Ø§Ø² Ù…Ø´ØªØ±ÛŒ:</span><span id="r_shipRate"></span>
      </div>
      <div class="result-line">
        <span id="lblShipCost">Ù‡Ø²ÛŒÙ†Ù‡ Ø¨Ø§Ø±Ø¨Ø±ÛŒ Ø§Ø² Ù…Ø´ØªØ±ÛŒ:</span><span id="r_shipCost"></span>
      </div>
      <div class="result-line highlight">
        <span id="lblFinalPriceEuro">Ù…Ø¨Ù„Øº Ù†Ù‡Ø§ÛŒÛŒ Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª (ÛŒÙˆØ±Ùˆ):</span><span id="r_finalPrice"></span>
      </div>
      <div class="result-line">
        <span id="lblFinalPriceRial">Ù…Ø¨Ù„Øº Ù†Ù‡Ø§ÛŒÛŒ (ØªÙ‚Ø±ÛŒØ¨ÛŒ Ø¨Ù‡ Ø±ÛŒØ§Ù„):</span>
        <span id="r_finalPriceRial"></span>
      </div>
    </div>

    <h2 class="section-title" id="sectionInternalTitle">Ù†ØªØ§ÛŒØ¬ Ø¯Ø§Ø®Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Belvia</h2>
    <div class="result-block">
      <div class="result-line">
        <span id="lblProfit">Ø³ÙˆØ¯ Ø±ÙˆÛŒ Ú©Ø§Ù„Ø§ (Û²Û²Ùª):</span><span id="r_profit"></span>
      </div>
      <div class="result-line">
        <span id="lblYourShip">Ù‡Ø²ÛŒÙ†Ù‡ Ø¨Ø§Ø±Ø¨Ø±ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ ØªÙˆ (Û±Ûµ â‚¬/kg):</span><span id="r_yourShip"></span>
      </div>
      <div class="result-line">
        <span id="lblYourTotal">Ù‡Ø²ÛŒÙ†Ù‡ ØªÙ…Ø§Ù…â€ŒØ´Ø¯Ù‡ (Ú©Ø§Ù„Ø§ + Ø¨Ø§Ø±Ø¨Ø±ÛŒ):</span><span id="r_yourTotal"></span>
      </div>
      <div class="result-line highlight">
        <span id="lblProfitFinal">Ø³ÙˆØ¯ Ù†Ù‡Ø§ÛŒÛŒ Ø§ÛŒÙ† Ø³ÙØ§Ø±Ø´:</span><span id="r_profitFinal"></span>
      </div>
    </div>
  </div>

  <p class="footer" id="footerText">Â© Ø§Ø¨Ø²Ø§Ø± Ø¯Ø§Ø®Ù„ÛŒ Belvia â€“ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§</p>
</div>

<script>
let eurToRialRate = null;  // Ù†Ø±Ø® ÛŒÙˆØ±Ùˆ Ø¨Ù‡ Ø±ÛŒØ§Ù„
let currentLang = 'fa';

const texts = {
  fa: {
    appTitle: "Ù…Ø§Ø´ÛŒÙ†â€ŒØ­Ø³Ø§Ø¨ Ø³ÙØ§Ø±Ø´Ø§Øª Ø¨ÙÙ„ÙˆÛŒÙ€Ù€Ø§",
    appDesc: "Ù…Ø­Ø§Ø³Ø¨Ù‡â€ŒÛŒ Ù‚ÛŒÙ…ØªØŒ Ø¨Ø§Ø±Ø¨Ø±ÛŒØŒ Ø³ÙˆØ¯ Ùˆ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÛŒ Ù†Ù‡Ø§ÛŒÛŒ (Ø¯Ø§Ø®Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Belvia)",
    langToggle: "English ğŸ‡¬ğŸ‡§",
    labelCustomer: "Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ:",
    customerPlaceholder: "Ù…Ø«Ù„Ø§Ù‹ Ø®Ø§Ù†Ù… Ø±Ø¶Ø§ÛŒÛŒ",
    labelEurRate: "Ù†Ø±Ø® ÛŒÙˆØ±Ùˆ Ø¨Ù‡ Ø±ÛŒØ§Ù„ (Bonbast):",
    setRate: "Ø«Ø¨Øª Ù†Ø±Ø®",
    openBonbast: "Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Bonbast",
    eurRateUnset: "(Ù‡Ù†ÙˆØ² ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡)",
    labelNumProducts: "ØªØ¹Ø¯Ø§Ø¯ Ù…Ø­ØµÙˆÙ„Ø§Øª:",
    btnGenerate: "Ø«Ø¨Øª Ù…Ø­ØµÙˆÙ„Ø§Øª",
    calcBtn: "Ù…Ø­Ø§Ø³Ø¨Ù‡",
    invoiceBtn: "ÙØ§Ú©ØªÙˆØ± PDF Ø¨Ø±Ø§ÛŒ Ù…Ø´ØªØ±ÛŒ",
    thIndex: "Ø±Ø¯ÛŒÙ",
    thName: "Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„",
    thPrice: "Ù‚ÛŒÙ…Øª (â‚¬)",
    thWeight: "ÙˆØ²Ù† (kg)",
    thDiscount: "ØªØ®ÙÛŒÙ (%)",
    sectionCustomerTitle: "Ù†ØªØ§ÛŒØ¬ Ø¨Ø±Ø§ÛŒ Ù…Ø´ØªØ±ÛŒ",
    sectionInternalTitle: "Ù†ØªØ§ÛŒØ¬ Ø¯Ø§Ø®Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Belvia",
    lblTotalBase: "Ø¬Ù…Ø¹ Ù‚ÛŒÙ…Øª Ú©Ø§Ù„Ø§ (Ø¨Ø¹Ø¯ Ø§Ø² ØªØ®ÙÛŒÙ):",
    lblTotalWeight: "ÙˆØ²Ù† Ú©Ù„ Ø³ÙØ§Ø±Ø´:",
    lblShipRate: "Ù†Ø±Ø® Ø¨Ø§Ø±Ø¨Ø±ÛŒ Ø§Ø² Ù…Ø´ØªØ±ÛŒ:",
    lblShipCost: "Ù‡Ø²ÛŒÙ†Ù‡ Ø¨Ø§Ø±Ø¨Ø±ÛŒ Ø§Ø² Ù…Ø´ØªØ±ÛŒ:",
    lblFinalPriceEuro: "Ù…Ø¨Ù„Øº Ù†Ù‡Ø§ÛŒÛŒ Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª (ÛŒÙˆØ±Ùˆ):",
    lblFinalPriceRial: "Ù…Ø¨Ù„Øº Ù†Ù‡Ø§ÛŒÛŒ (ØªÙ‚Ø±ÛŒØ¨ÛŒ Ø¨Ù‡ Ø±ÛŒØ§Ù„):",
    lblProfit: "Ø³ÙˆØ¯ Ø±ÙˆÛŒ Ú©Ø§Ù„Ø§ (Û²Û²Ùª):",
    lblYourShip: "Ù‡Ø²ÛŒÙ†Ù‡ Ø¨Ø§Ø±Ø¨Ø±ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ ØªÙˆ (Û±Ûµ â‚¬/kg):",
    lblYourTotal: "Ù‡Ø²ÛŒÙ†Ù‡ ØªÙ…Ø§Ù…â€ŒØ´Ø¯Ù‡ (Ú©Ø§Ù„Ø§ + Ø¨Ø§Ø±Ø¨Ø±ÛŒ):",
    lblProfitFinal: "Ø³ÙˆØ¯ Ù†Ù‡Ø§ÛŒÛŒ Ø§ÛŒÙ† Ø³ÙØ§Ø±Ø´:",
    footerText: "Â© Ø§Ø¨Ø²Ø§Ø± Ø¯Ø§Ø®Ù„ÛŒ Belvia â€“ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§",
    alerts: {
      enterRate: "Ù„Ø·ÙØ§Ù‹ Ù†Ø±Ø® ÛŒÙˆØ±Ùˆ Ø¨Ù‡ Ø±ÛŒØ§Ù„ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ø§Ø² Bonbast).",
      invalidRate: "Ù†Ø±Ø® ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª.",
      enterRateFirst: "Ø§Ø¨ØªØ¯Ø§ Ù†Ø±Ø® Ø±Ø§ Ø§Ø² Bonbast ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯."
    },
    invoice: {
      title: "ÙØ§Ú©ØªÙˆØ± ÙØ±ÙˆØ´",
      subtitle: "Belvia Online Shop",
      customer: "Ù…Ø´ØªØ±ÛŒ",
      date: "ØªØ§Ø±ÛŒØ®",
      thIndex: "Ø±Ø¯ÛŒÙ",
      thName: "Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„",
      thUnitPrice: "Ù‚ÛŒÙ…Øª ÙˆØ§Ø­Ø¯ (â‚¬)",
      thDiscount: "ØªØ®ÙÛŒÙ",
      thFinalPrice: "Ù‚ÛŒÙ…Øª Ù†Ù‡Ø§ÛŒÛŒ (â‚¬)",
      thWeight: "ÙˆØ²Ù† (kg)",
      totalGoods: "Ø¬Ù…Ø¹ Ú©Ø§Ù„Ø§ (Ù¾Ø³ Ø§Ø² ØªØ®ÙÛŒÙ):",
      shippingCost: "Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ø±Ø³Ø§Ù„:",
      finalEuro: "Ù…Ø¨Ù„Øº Ù†Ù‡Ø§ÛŒÛŒ Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª (ÛŒÙˆØ±Ùˆ):",
      finalRial: "Ù…Ø¨Ù„Øº Ù†Ù‡Ø§ÛŒÛŒ (ØªÙ‚Ø±ÛŒØ¨ÛŒ Ø¨Ù‡ Ø±ÛŒØ§Ù„):",
      eurRateLabel: "Ù†Ø±Ø® ÛŒÙˆØ±Ùˆ Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡:",
      totalWeight: "ÙˆØ²Ù† Ú©Ù„ Ø³ÙØ§Ø±Ø´:",
      contactTitle: "Ø±Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ù…Ø§:",
      instagram: "Instagram",
      telegramChannel: "Telegram channel",
      support: "Support (Telegram)",
      note1: "Ù‡Ø²ÛŒÙ†Ù‡â€ŒÛŒ Ø§Ø±Ø³Ø§Ù„ Ø§Ø² Ø§ÛŒØ±Ø§Ù† ØªØ§ Ø¯Ø±Ø¨ Ù…Ù†Ø²Ù„ (Ù¾Ø³Øª Ø¯Ø§Ø®Ù„ÛŒ / Ù¾ÛŒÚ©) Ø¨Ø± Ø¹Ù‡Ø¯Ù‡â€ŒÛŒ Ù…Ø´ØªØ±ÛŒ Ø§Ø³Øª.",
      note2: "Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ Ù†ÙˆØ³Ø§Ù†Ø§Øª Ù†Ø±Ø® ÛŒÙˆØ±ÙˆØŒ Ù‚ÛŒÙ…Øª Ø±ÛŒØ§Ù„ÛŒ Ù†Ù‡Ø§ÛŒÛŒ ØªØ§ Ù¾Ø§ÛŒØ§Ù† Ø±ÙˆØ² Ú©Ø§Ø±ÛŒ Ø§Ø¹ØªØ¨Ø§Ø± Ø¯Ø§Ø±Ø¯.",
      thanks: "Ø§Ø² Ø§Ø¹ØªÙ…Ø§Ø¯ Ùˆ Ø®Ø±ÛŒØ¯ Ø´Ù…Ø§ Ø§Ø² Belvia ØµÙ…ÛŒÙ…Ø§Ù†Ù‡ Ù…ØªØ´Ú©Ø±ÛŒÙ…."
    }
  },
  en: {
    appTitle: "Belvia Order Calculator",
    appDesc: "Internal tool for calculating price, shipping and profit for Belvia orders.",
    langToggle: "ÙØ§Ø±Ø³ÛŒ ğŸ‡®ğŸ‡·",
    labelCustomer: "Customer name:",
    customerPlaceholder: "e.g. Mrs. Rezaei",
    labelEurRate: "EUR to Rial rate (Bonbast):",
    setRate: "Set rate",
    openBonbast: "Open Bonbast",
    eurRateUnset: "(not set yet)",
    labelNumProducts: "Number of products:",
    btnGenerate: "Create product rows",
    calcBtn: "Calculate",
    invoiceBtn: "Customer PDF Invoice",
    thIndex: "No.",
    thName: "Product name",
    thPrice: "Price (â‚¬)",
    thWeight: "Weight (kg)",
    thDiscount: "Discount (%)",
    sectionCustomerTitle: "Customer results",
    sectionInternalTitle: "Internal results (Belvia)",
    lblTotalBase: "Total goods (after discount):",
    lblTotalWeight: "Total order weight:",
    lblShipRate: "Shipping rate to customer:",
    lblShipCost: "Shipping cost (customer):",
    lblFinalPriceEuro: "Final amount to pay (EUR):",
    lblFinalPriceRial: "Final amount (approx. in Rial):",
    lblProfit: "Margin on goods (22%):",
    lblYourShip: "Your real shipping cost (15 â‚¬/kg):",
    lblYourTotal: "Total internal cost (goods + shipping):",
    lblProfitFinal: "Final profit on this order:",
    footerText: "Â© Belvia internal tool â€“ order management only",
    alerts: {
      enterRate: "Please enter the EUR to Rial rate (from Bonbast).",
      invalidRate: "The entered rate is not valid.",
      enterRateFirst: "Please set the Bonbast rate first."
    },
    invoice: {
      title: "Sales Invoice",
      subtitle: "Belvia Online Shop",
      customer: "Customer",
      date: "Date",
      thIndex: "No.",
      thName: "Product",
      thUnitPrice: "Unit price (â‚¬)",
      thDiscount: "Discount",
      thFinalPrice: "Final price (â‚¬)",
      thWeight: "Weight (kg)",
      totalGoods: "Goods total (after discount):",
      shippingCost: "Shipping cost:",
      finalEuro: "Final amount to pay (EUR):",
      finalRial: "Final amount (approx. in Rial):",
      eurRateLabel: "EUR rate used:",
      totalWeight: "Total order weight:",
      contactTitle: "Contact us:",
      instagram: "Instagram",
      telegramChannel: "Telegram channel",
      support: "Support (Telegram)",
      note1: "Local delivery cost inside Iran (post / courier) is paid by the customer.",
      note2: "Due to EUR exchange rate fluctuations, the Rial amount is valid until the end of the business day.",
      thanks: "Thank you sincerely for shopping with Belvia."
    }
  }
};

function applyLanguage() {
  const t = texts[currentLang];

  document.getElementById("appTitle").textContent = t.appTitle;
  document.getElementById("appDesc").textContent = t.appDesc;
  document.getElementById("langToggle").textContent = t.langToggle;

  document.getElementById("labelCustomer").textContent = t.labelCustomer;
  document.getElementById("customerName").placeholder = t.customerPlaceholder;

  document.getElementById("labelEurRate").textContent = t.labelEurRate;
  document.getElementById("btnSetRate").textContent = t.setRate;
  document.getElementById("btnOpenBonbast").textContent = t.openBonbast;

  // Ø§Ú¯Ø± Ù‡Ù†ÙˆØ² Ù†Ø±Ø® Ø³Øª Ù†Ø´Ø¯Ù‡ Ø¨ÙˆØ¯ØŒ Ù…ØªÙ† Ø®Ø§Ù„ÛŒ/Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø±Ùˆ Ø¢Ù¾Ø¯ÛŒØª Ú©Ù†
  const rateLabel = document.getElementById("eurRateLabel");
  if (!eurToRialRate) {
    rateLabel.textContent = t.eurRateUnset;
  }

  document.getElementById("labelNumProducts").textContent = t.labelNumProducts;
  document.getElementById("btnGenerate").textContent = t.btnGenerate;
  document.getElementById("calcBtn").textContent = t.calcBtn;
  document.getElementById("invoiceBtn").textContent = t.invoiceBtn;

  document.getElementById("thIndex").textContent = t.thIndex;
  document.getElementById("thName").textContent = t.thName;
  document.getElementById("thPrice").textContent = t.thPrice;
  document.getElementById("thWeight").textContent = t.thWeight;
  document.getElementById("thDiscount").textContent = t.thDiscount;

  document.getElementById("sectionCustomerTitle").textContent = t.sectionCustomerTitle;
  document.getElementById("sectionInternalTitle").textContent = t.sectionInternalTitle;

  document.getElementById("lblTotalBase").textContent = t.lblTotalBase;
  document.getElementById("lblTotalWeight").textContent = t.lblTotalWeight;
  document.getElementById("lblShipRate").textContent = t.lblShipRate;
  document.getElementById("lblShipCost").textContent = t.lblShipCost;
  document.getElementById("lblFinalPriceEuro").textContent = t.lblFinalPriceEuro;
  document.getElementById("lblFinalPriceRial").textContent = t.lblFinalPriceRial;

  document.getElementById("lblProfit").textContent = t.lblProfit;
  document.getElementById("lblYourShip").textContent = t.lblYourShip;
  document.getElementById("lblYourTotal").textContent = t.lblYourTotal;
  document.getElementById("lblProfitFinal").textContent = t.lblProfitFinal;

  document.getElementById("footerText").textContent = t.footerText;
}

function toggleLanguage() {
  currentLang = (currentLang === 'fa') ? 'en' : 'fa';
  applyLanguage();
}

function openBonbast() {
  window.open("https://www.bonbast.com/", "_blank");
}

function setEurRateFromInput() {
  const t = texts[currentLang];
  const input = document.getElementById("eurRateInput").value.trim();
  if (!input) {
    alert(t.alerts.enterRate);
    return;
  }
  const val = parseFloat(input.replace(/,/g, ""));
  if (isNaN(val) || val <= 0) {
    alert(t.alerts.invalidRate);
    return;
  }
  eurToRialRate = val;
  document.getElementById("eurRateLabel").textContent =
    val.toLocaleString("fa-IR") + " Ø±ÛŒØ§Ù„ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Û± ÛŒÙˆØ±Ùˆ";
}

function generateRows() {
  const n = parseInt(document.getElementById("numProducts").value);
  const tbody = document.getElementById("productsTbody");
  tbody.innerHTML = "";
  if (!n || n < 1) return;

  for (let i = 0; i < n; i++) {
    tbody.innerHTML += `
      <tr>
        <td>${i+1}</td>
        <td><input id="name_${i}" type="text" class="product-name-input" placeholder="Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„"></td>
        <td><input id="p_${i}" type="number" step="0.01"></td>
        <td><input id="w_${i}" type="number" step="0.01"></td>
        <td><input id="d_${i}" type="number" value="0"></td>
      </tr>`;
  }

  document.getElementById("productsTable").style.display = "table";
  document.getElementById("calcBtn").style.display = "inline-block";
}

function calculate() {
  const t = texts[currentLang];
  const rows = document.querySelectorAll("#productsTbody tr").length;
  let base = 0, weight = 0;

  for (let i = 0; i < rows; i++) {
    const p = parseFloat(document.getElementById(`p_${i}`).value) || 0;
    const w = parseFloat(document.getElementById(`w_${i}`).value) || 0;
    const d = parseFloat(document.getElementById(`d_${i}`).value) || 0;
    const eff = p * (1 - d / 100);

    base += eff;
    weight += w;
  }

  let rate = weight > 6 ? 25 : (base >= 100 ? 30 : 35);
  const ship = weight * rate;
  const profit = base * 0.22;
  const yourShip = weight * 15;
  const yourTotal = base + yourShip;
  const finalPrice = base + profit + ship;
  const profitFinal = finalPrice - yourTotal;

  document.getElementById("r_totalBase").textContent   = base.toFixed(2)   + " â‚¬";
  document.getElementById("r_totalWeight").textContent = weight.toFixed(2) + " kg";
  document.getElementById("r_shipRate").textContent    = rate + " â‚¬/kg";
  document.getElementById("r_shipCost").textContent    = ship.toFixed(2)   + " â‚¬";
  document.getElementById("r_finalPrice").textContent  = finalPrice.toFixed(2) + " â‚¬";

  if (eurToRialRate) {
    const rialValue = finalPrice * eurToRialRate;
    document.getElementById("r_finalPriceRial").textContent =
      rialValue.toLocaleString("fa-IR") + " Ø±ÛŒØ§Ù„";
  } else {
    document.getElementById("r_finalPriceRial").textContent =
      t.alerts.enterRateFirst;
  }

  document.getElementById("r_profit").textContent      = profit.toFixed(2)     + " â‚¬";
  document.getElementById("r_yourShip").textContent    = yourShip.toFixed(2)   + " â‚¬";
  document.getElementById("r_yourTotal").textContent   = yourTotal.toFixed(2)  + " â‚¬";
  document.getElementById("r_profitFinal").textContent = profitFinal.toFixed(2)+ " â‚¬";

  document.getElementById("resultsSection").style.display = "block";
  document.getElementById("invoiceBtn").style.display = "inline-block";
}

function openInvoiceWindow() {
  const t = texts[currentLang].invoice;
  const rows = document.querySelectorAll("#productsTbody tr").length;
  if (rows === 0) return;

  const customer = document.getElementById("customerName").value || (currentLang === 'fa' ? "Ù…Ø´ØªØ±ÛŒ" : "Customer");

  let baseNet = 0;
  let totalRetail = 0;
  let weight = 0;
  let rowsHtml = "";

  for (let i = 0; i < rows; i++) {
    const nameInput = (document.getElementById(`name_${i}`).value || "").trim();
    const name = nameInput || (currentLang === 'fa' ? `Ù…Ø­ØµÙˆÙ„ ${i+1}` : `Product ${i+1}`);
    const p = parseFloat(document.getElementById(`p_${i}`).value) || 0;
    const w = parseFloat(document.getElementById(`w_${i}`).value) || 0;
    const d = parseFloat(document.getElementById(`d_${i}`).value) || 0;

    const effNet = p * (1 - d / 100);
    const retailBase = p * 1.22;
    const retailFinal = effNet * 1.22;

    baseNet     += effNet;
    totalRetail += retailFinal;
    weight      += w;

    rowsHtml += `
      <tr>
        <td>${i+1}</td>
        <td>${name}</td>
        <td>${retailBase.toFixed(2)} â‚¬</td>
        <td>${d.toFixed(2)}%</td>
        <td>${retailFinal.toFixed(2)} â‚¬</td>
        <td>${w.toFixed(2)} kg</td>
      </tr>`;
  }

  let rate = weight > 6 ? 25 : (baseNet >= 100 ? 30 : 35);
  const ship = weight * rate;

  const finalPriceCustomer = totalRetail + ship;

  let finalPriceCustomerRialText = currentLang === 'fa'
    ? "Ù†Ø±Ø® Ø±ÛŒØ§Ù„ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª"
    : "Rial rate not set";
  if (eurToRialRate) {
    const rialVal = finalPriceCustomer * eurToRialRate;
    finalPriceCustomerRialText =
      rialVal.toLocaleString("fa-IR") + " Ø±ÛŒØ§Ù„";
  }

  let eurRateText = currentLang === 'fa' ? "Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡" : "Not set";
  if (eurToRialRate) {
    eurRateText = eurToRialRate.toLocaleString("fa-IR") + " Ø±ÛŒØ§Ù„ / 1 EUR";
  }

  const date = currentLang === 'fa'
    ? new Date().toLocaleDateString("fa-IR")
    : new Date().toLocaleDateString("en-GB");

  if (currentLang === 'fa') {
    const html = `
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<title>${t.title}</title>
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;600&display=swap" rel="stylesheet">
<style>
body{font-family:"Vazirmatn",sans-serif;margin:0;background:#f3efe9;color:#2a2a2a}
.card{max-width:820px;margin:30px auto;background:#fff;border-radius:18px;box-shadow:0 16px 40px rgba(0,0,0,0.1);overflow:hidden}
.header{background:linear-gradient(135deg,#a68b78,#8c6f5b);color:#fff;padding:15px 20px;display:flex;justify-content:space-between;align-items:center}
.header img{
  height:90px;
  background:#ffffff;
  border-radius:50%;
  padding:8px;
  box-shadow:0 0 8px rgba(0,0,0,0.2);
}
.header h2{margin:0;font-size:1.3rem}
.header span{font-size:.9rem;opacity:.9}
.body{padding:20px}
.info-row{display:flex;justify-content:space-between;flex-wrap:wrap;font-size:.9rem;margin-bottom:10px}
.info-row div{margin-bottom:4px}
table{width:100%;border-collapse:collapse;margin-top:12px;font-size:.9rem}
th,td{border:1px solid #e1dad2;padding:6px;text-align:center}
th{background:#f7f3ef;color:#6c5e53}
tbody tr:nth-child(even){background:#fbf8f4}
.totals-wrap{margin-top:18px;display:flex;justify-content:space-between;flex-wrap:wrap;gap:12px}
.totals-box{min-width:260px;border-radius:14px;border:1px solid #e1dad2;background:#fdf8f3;padding:10px 12px;font-size:.9rem}
.totals-box div{display:flex;justify-content:space-between;margin-bottom:4px}
.totals-box .final{margin-top:6px;padding-top:6px;border-top:1px dashed #d0c1b3;font-weight:600;color:#8c6f5b;font-size:1rem}
.meta{font-size:.85rem;color:#6f6660;display:flex;flex-direction:column;gap:4px;align-items:flex-start;justify-content:flex-end}
.contact{margin-top:22px;border-top:1px solid #e1dad2;padding-top:10px;font-size:.85rem;color:#6f6660}
.contact-title{font-weight:600;margin-bottom:4px}
.contact-line{margin-bottom:2px}
.note{margin-top:8px;font-size:.8rem;color:#8a7f77}
</style>
</head>

<body>
<div class="card">
  <div class="header">
    <div>
      <h2>${t.title}</h2>
      <span>${t.subtitle}</span>
    </div>
    <img src="${location.origin}/Brown.png" alt="Belvia Logo">
  </div>

  <div class="body">
    <div class="info-row">
      <div>${t.customer}: <strong>${customer}</strong></div>
      <div>${t.date}: <strong>${date}</strong></div>
    </div>

    <table>
      <thead>
        <tr>
          <th>${t.thIndex}</th>
          <th>${t.thName}</th>
          <th>${t.thUnitPrice}</th>
          <th>${t.thDiscount}</th>
          <th>${t.thFinalPrice}</th>
          <th>${t.thWeight}</th>
        </tr>
      </thead>
      <tbody>
        ${rowsHtml}
      </tbody>
    </table>

    <div class="totals-wrap">
      <div class="totals-box">
        <div><span>${t.totalGoods}</span><span>${totalRetail.toFixed(2)} â‚¬</span></div>
        <div><span>${t.shippingCost}</span><span>${ship.toFixed(2)} â‚¬</span></div>
        <div class="final"><span>${t.finalEuro}</span><span>${finalPriceCustomer.toFixed(2)} â‚¬</span></div>
        <div><span>${t.finalRial}</span><span>${finalPriceCustomerRialText}</span></div>
        <div><span>${t.eurRateLabel}</span><span>${eurRateText}</span></div>
      </div>
      <div class="meta">
        <div>${t.totalWeight} <strong>${weight.toFixed(2)} kg</strong></div>
      </div>
    </div>

    <div class="contact">
      <div class="contact-title">${t.contactTitle}</div>
      <div class="contact-line">${t.instagram}: <strong>@bybelvia_onlineshop</strong></div>
      <div class="contact-line">${t.telegramChannel}: <strong>@bybelviaonlineshop</strong></div>
      <div class="contact-line">${t.support}: <strong>@bybelvia</strong></div>
      <div class="note">
        <div>${t.note1}</div>
        <div>${t.note2}</div>
        <div>${t.thanks}</div>
      </div>
    </div>
  </div>
</div>
</body>
</html>`;

    const win = window.open("", "_blank");
    if (!win) return;
    win.document.write(html);
    win.document.close();
    win.onload = () => win.print();
  } else {
    const html = `
<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>${t.title}</title>
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;600&display=swap" rel="stylesheet">
<style>
body{font-family:"Vazirmatn",sans-serif;margin:0;background:#f3efe9;color:#2a2a2a}
.card{max-width:820px;margin:30px auto;background:#fff;border-radius:18px;box-shadow:0 16px 40px rgba(0,0,0,0.1);overflow:hidden}
.header{background:linear-gradient(135deg,#a68b78,#8c6f5b);color:#fff;padding:15px 20px;display:flex;justify-content:space-between;align-items:center}
.header img{
  height:90px;
  background:#ffffff;
  border-radius:50%;
  padding:8px;
  box-shadow:0 0 8px rgba(0,0,0,0.2);
}
.header h2{margin:0;font-size:1.3rem}
.header span{font-size:.9rem;opacity:.9}
.body{padding:20px}
.info-row{display:flex;justify-content:space-between;flex-wrap:wrap;font-size:.9rem;margin-bottom:10px}
.info-row div{margin-bottom:4px}
table{width:100%;border-collapse:collapse;margin-top:12px;font-size:.9rem}
th,td{border:1px solid #e1dad2;padding:6px;text-align:center}
th{background:#f7f3ef;color:#6c5e53}
tbody tr:nth-child(even){background:#fbf8f4}
.totals-wrap{margin-top:18px;display:flex;justify-content:space-between;flex-wrap:wrap;gap:12px}
.totals-box{min-width:260px;border-radius:14px;border:1px solid #e1dad2;background:#fdf8f3;padding:10px 12px;font-size:.9rem}
.totals-box div{display:flex;justify-content:space-between;margin-bottom:4px}
.totals-box .final{margin-top:6px;padding-top:6px;border-top:1px dashed #d0c1b3;font-weight:600;color:#8c6f5b;font-size:1rem}
.meta{font-size:.85rem;color:#6f6660;display:flex;flex-direction:column;gap:4px;align-items:flex-start;justify-content:flex-end}
.contact{margin-top:22px;border-top:1px solid #e1dad2;padding-top:10px;font-size:.85rem;color:#6f6660}
.contact-title{font-weight:600;margin-bottom:4px}
.contact-line{margin-bottom:2px}
.note{margin-top:8px;font-size:.8rem;color:#8a7f77}
</style>
</head>

<body>
<div class="card">
  <div class="header">
    <div>
      <h2>${t.title}</h2>
      <span>${t.subtitle}</span>
    </div>
    <img src="${location.origin}/Brown.png" alt="Belvia Logo">
  </div>

  <div class="body">
    <div class="info-row">
      <div>${t.customer}: <strong>${customer}</strong></div>
      <div>${t.date}: <strong>${date}</strong></div>
    </div>

    <table>
      <thead>
        <tr>
          <th>${t.thIndex}</th>
          <th>${t.thName}</th>
          <th>${t.thUnitPrice}</th>
          <th>${t.thDiscount}</th>
          <th>${t.thFinalPrice}</th>
          <th>${t.thWeight}</th>
        </tr>
      </thead>
      <tbody>
        ${rowsHtml}
      </tbody>
    </table>

    <div class="totals-wrap">
      <div class="totals-box">
        <div><span>${t.totalGoods}</span><span>${totalRetail.toFixed(2)} â‚¬</span></div>
        <div><span>${t.shippingCost}</span><span>${ship.toFixed(2)} â‚¬</span></div>
        <div class="final"><span>${t.finalEuro}</span><span>${finalPriceCustomer.toFixed(2)} â‚¬</span></div>
        <div><span>${t.finalRial}</span><span>${finalPriceCustomerRialText}</span></div>
        <div><span>${t.eurRateLabel}</span><span>${eurRateText}</span></div>
      </div>
      <div class="meta">
        <div>${t.totalWeight} <strong>${weight.toFixed(2)} kg</strong></div>
      </div>
    </div>

    <div class="contact">
      <div class="contact-title">${t.contactTitle}</div>
      <div class="contact-line">${t.instagram}: <strong>@bybelvia_onlineshop</strong></div>
      <div class="contact-line">${t.telegramChannel}: <strong>@bybelviaonlineshop</strong></div>
      <div class="contact-line">${t.support}: <strong>@bybelvia</strong></div>
      <div class="note">
        <div>${t.note1}</div>
        <div>${t.note2}</div>
        <div>${t.thanks}</div>
      </div>
    </div>
  </div>
</div>
</body>
</html>`;

    const win = window.open("", "_blank");
    if (!win) return;
    win.document.write(html);
    win.document.close();
    win.onload = () => win.print();
  }
}

// Ø¨Ø§Ø± Ø§ÙˆÙ„ Ú©Ù‡ ØµÙØ­Ù‡ Ù„ÙˆØ¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŒ ÙØ§Ø±Ø³ÛŒ Ø±Ø§ Ø§Ø¹Ù…Ø§Ù„ Ú©Ù†
applyLanguage();
</script>

<script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("service-worker.js");
  });
}
</script>

</body>
</html>