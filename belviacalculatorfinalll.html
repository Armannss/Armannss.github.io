<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ماشین‌حساب سفارشات بِلویــا</title>

  <!-- تنظیمات PWA و موبایل -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#000000">

  <!-- برای iOS (وب‌اپ فول‌اسکرین) -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Belvia Calc">
  <link rel="apple-touch-icon" href="Brown.png">

  <!-- فونت فارسی -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    :root {
      --accent: #a68b78;      /* قهوه‌ای لوگو */
      --accent-dark: #8c6f5b;
      --bg-color: #faf7f3;
      --card-bg: #ffffff;
      --text-main: #2a2a2a;
      --border: #e3ddd8;
      --muted: #7a736d;
      --error: #c0392b;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 25px;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      background: radial-gradient(circle at top, #ffffff 0%, #f2ede9 60%, #e7e1db 100%);
      font-family: "Vazirmatn", sans-serif;
      color: var(--text-main);
    }

    .container {
      width: 100%;
      max-width: 960px;
      background: var(--card-bg);
      border-radius: 22px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.10);
      padding: 24px 28px 30px;
    }

    /* لوگو بالا */
    .logo-box {
      text-align: center;
      margin-bottom: 20px;
    }

    .logo-box img {
      height: 130px;  /* لوگو بزرگ‌تر */
      width: auto;
      object-fit: contain;
      filter: drop-shadow(0 4px 10px rgba(0,0,0,0.18));
    }

    h1 {
      text-align: center;
      margin: 0 0 8px;
      font-size: 1.4rem;
      font-weight: 600;
      color: var(--accent-dark);
    }

    .desc {
      text-align: center;
      color: var(--muted);
      margin-bottom: 20px;
      font-size: 0.85rem;
    }

    .top-row {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    label { font-size: 0.9rem; }

    input[type="number"] {
      padding: 7px 9px;
      border-radius: 10px;
      border: 1px solid var(--border);
      direction: ltr;
      text-align: left;
      width: 110px;
      font-size: 0.85rem;
    }

    input[type="number"]:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(166,139,120,0.28);
    }

    button {
      padding: 8px 18px;
      border-radius: 999px;
      border: none;
      font-size: 0.85rem;
      cursor: pointer;
      font-weight: 500;
      transition: 0.12s ease;
    }

    .btn-main {
      background: linear-gradient(135deg, var(--accent), var(--accent-dark));
      color: white;
      box-shadow: 0 10px 18px rgba(166,139,120,0.35);
    }

    .btn-main:hover { transform: translateY(-1px); }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      font-size: 0.85rem;
      border-radius: 14px;
      overflow: hidden;
    }

    table th, table td {
      border: 1px solid var(--border);
      padding: 8px;
      text-align: center;
    }

    table th {
      background: #f7f2ee;
      color: #6c5e53;
      font-weight: 600;
    }

    .error {
      color: var(--error);
      font-size: 0.82rem;
      margin-top: 6px;
      display: none;
    }

    .section-title {
      margin-top: 24px;
      margin-bottom: 8px;
      font-size: 1rem;
      font-weight: 600;
      color: var(--accent-dark);
    }

    .result-block {
      margin-top: 10px;
      padding: 12px 14px;
      border-radius: 14px;
      background: #f9f6f2;
      border: 1px solid #e8e2dc;
      font-size: 0.9rem;
    }

    .result-line {
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
    }

    .highlight {
      font-weight: 600;
      color: var(--accent-dark);
    }

    .footer {
      margin-top: 20px;
      text-align: center;
      font-size: 0.75rem;
      color: var(--muted);
    }

    @media (max-width: 640px) {
      body { padding: 12px; }
      .container { padding: 18px; }
      .result-line { flex-direction: column; align-items: flex-start; }
    }
  </style>
</head>
<body>

  <div class="container">
    <!-- لوگو -->
    <div class="logo-box">
      <!-- حتماً Brown.png کنار index.html باشد -->
      <img src="Brown.png" alt="Belvia Logo">
    </div>

    <h1>ماشین‌حساب سفارشات بِلویــا</h1>
    <p class="desc">
      محاسبه‌ی خودکار قیمت، باربری، سود و هزینه‌ی تمام‌شده.
      (سفارش‌های بالای ۶ کیلو با نرخ ۲۵ یورو به‌ازای هر کیلو محاسبه می‌شوند)
    </p>

    <!-- تعداد محصولات -->
    <div class="top-row">
      <label for="numProducts">تعداد محصولات:</label>
      <input id="numProducts" type="number" min="1" value="1">
      <button class="btn-main" onclick="generateRows()">ثبت محصولات</button>
    </div>

    <div id="errorBox" class="error"></div>

    <!-- جدول محصولات -->
    <table id="productsTable" style="display:none;">
      <thead>
        <tr>
          <th>ردیف</th>
          <th>قیمت اصلی (یورو)</th>
          <th>وزن (کیلو)</th>
          <th>تخفیف (%)</th>
        </tr>
      </thead>
      <tbody id="productsTbody"></tbody>
    </table>

    <button id="calcBtn" class="btn-main" style="display:none; margin-top:12px;" onclick="calculate()">
      محاسبه
    </button>

    <!-- نتایج -->
    <div id="resultsSection" style="display:none;">
      <h2 class="section-title">نتایج برای مشتری</h2>
      <div class="result-block">
        <div class="result-line"><span>جمع قیمت (با تخفیف):</span><span id="r_totalBase"></span></div>
        <div class="result-line"><span>سود روی کالا (۲۲٪):</span><span id="r_profit"></span></div>
        <div class="result-line"><span>وزن کل:</span><span id="r_totalWeight"></span></div>
        <div class="result-line"><span>نرخ باربری مشتری:</span><span id="r_shipRate"></span></div>
        <div class="result-line"><span>هزینه‌ی باربری از مشتری:</span><span id="r_shipCost"></span></div>
        <div class="result-line highlight"><span>قیمت نهایی برای مشتری:</span><span id="r_finalPrice"></span></div>
      </div>

      <h2 class="section-title">نتیجه برای تو</h2>
      <div class="result-block">
        <div class="result-line"><span>هزینه‌ی باربری تو (۱۵ €/kg):</span><span id="r_yourShipping"></span></div>
        <div class="result-line"><span>هزینه‌ی تمام‌شده‌ی تو (کالا + باربری):</span><span id="r_yourTotal"></span></div>
        <div class="result-line highlight"><span>سود نهایی این سفارش:</span><span id="r_profitFinal"></span></div>
      </div>
    </div>

    <p class="footer">ابزار داخلی Belvia – فقط برای مدیریت قیمت‌گذاری سفارش‌ها</p>
  </div>

<script>
function showError(msg) {
  const box = document.getElementById("errorBox");
  box.textContent = msg;
  box.style.display = msg ? "block" : "none";
}

function generateRows() {
  const n = parseInt(document.getElementById("numProducts").value);
  const tbody = document.getElementById("productsTbody");
  tbody.innerHTML = "";
  showError("");

  if (isNaN(n) || n <= 0) {
    showError("لطفاً تعداد محصولات را درست وارد کن.");
    document.getElementById("productsTable").style.display = "none";
    document.getElementById("calcBtn").style.display = "none";
    document.getElementById("resultsSection").style.display = "none";
    return;
  }

  for (let i = 0; i < n; i++) {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${i + 1}</td>
      <td><input type="number" id="p_${i}" step="0.01"></td>
      <td><input type="number" id="w_${i}" step="0.01"></td>
      <td><input type="number" id="d_${i}" step="0.01" value="0"></td>
    `;
    tbody.appendChild(tr);
  }

  document.getElementById("productsTable").style.display = "table";
  document.getElementById("calcBtn").style.display = "inline-block";
  document.getElementById("resultsSection").style.display = "none";
}

function calculate() {
  const rows = document.querySelectorAll("#productsTbody tr").length;
  if (rows === 0) return;

  let base = 0;
  let weight = 0;

  for (let i = 0; i < rows; i++) {
    const p = parseFloat(document.getElementById(`p_${i}`).value) || 0;
    const w = parseFloat(document.getElementById(`w_${i}`).value) || 0;
    const d = parseFloat(document.getElementById(`d_${i}`).value) || 0;

    const eff = p * (1 - d / 100);   // قیمت بعد از تخفیف
    base += eff;
    weight += w;
  }

  // قانون باربری:
  // اگر وزن کل > ۶ کیلو → کیلویی ۲۵ یورو
  // در غیر این صورت: اگر جمع قیمت ≥ ۱۰۰ → ۳۰ یورو، وگرنه ۳۵ یورو
  let rate;
  if (weight > 6) {
    rate = 25;
  } else if (base >= 100) {
    rate = 30;
  } else {
    rate = 35;
  }

  const profit = base * 0.22;
  const ship = weight * rate;
  const finalPrice = base + profit + ship;

  const yourShip = weight * 15;
  const yourTotal = base + yourShip;
  const profitFinal = finalPrice - yourTotal;

  document.getElementById("r_totalBase").textContent   = base.toFixed(2) + " €";
  document.getElementById("r_profit").textContent      = profit.toFixed(2) + " €";
  document.getElementById("r_totalWeight").textContent = weight.toFixed(2) + " kg";
  document.getElementById("r_shipRate").textContent    = rate + " €/kg";
  document.getElementById("r_shipCost").textContent    = ship.toFixed(2) + " €";
  document.getElementById("r_finalPrice").textContent  = finalPrice.toFixed(2) + " €";

  document.getElementById("r_yourShipping").textContent = yourShip.toFixed(2) + " €";
  document.getElementById("r_yourTotal").textContent    = yourTotal.toFixed(2) + " €";
  document.getElementById("r_profitFinal").textContent  = profitFinal.toFixed(2) + " €";

  document.getElementById("resultsSection").style.display = "block";
}

// ثبت Service Worker برای PWA
if ("serviceWorker" in navigator) {
  window.addEventListener("load", function () {
    navigator.serviceWorker.register("service-worker.js").catch(function (err) {
      console.log("SW registration failed: ", err);
    });
  });
}
</script>

</body>
</html>